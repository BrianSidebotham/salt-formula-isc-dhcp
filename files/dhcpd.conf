{%- from "isc_dhcp/map.jinja" import server with context %}

{%- if server.omapi_port is defined -%}
omapi-port {{ server.omapi_port }};
{% endif -%}

ddns-update-style {{ server.ddns_update_style|default('none') }};

{%- if server.ddns_updates is defined %}
ddns-updates {{ server.ddns_updates }};
{%- endif -%}

{%- if server.update_static_leases is defined %}
update-static-leases {{ server.update_static_leases }};
{%- endif -%}

{%- if server.use_host_decl_names is defined %}
use-host-decl-names {{ server.use_host_decl_names }};
{{- "\n" }}
{%- endif -%}

{%- if server.zones is defined -%}
{%- for zone in server.dhcpd.zones|default({}) %}
zone {{ zone.name }} {
  primary {{ zone.primary }};
  {%- if 'key' in zone %}
  key {{ zone.key|default('rndc-key') }};
  {%- endif %}
}
{{- "\n" }}
{%- endfor -%}
{%- endif %}

default-lease-time {{ server.default_lease_time|default('600') }};
max-lease-time {{ server.max_lease_time|default('7200') }};

{%- if server.authoritative|default(False) %}
authoritative;
{%- endif %}

log-facility {{ server.logging.facility|default('local7') }};

{%- if server.next_server is defined -%}
{{ "\n" }}
next-server {{ server.next_server }};
{%- endif -%}

{%- if server.filename is defined %}
filename "{{ server.filename }}";
{{- "\n" }}
{%- endif -%}

{%- if server.allow is defined -%}
  {%- for a in server.dhcpd.allow|default([]) %}
allow {{ a }};
  {%- endfor -%}
{{ "\n" }}
{%- endif -%}

{%- if server.deny is defined -%}
  {%- for d in server.dhcpd.deny|default([]) %}
deny {{ d }};
  {%- endfor -%}
{{ "\n" }}
{%- endif -%}

{%- if server.ignore is defined -%}
  {%- for i in server.ignore|default([]) %}
ignore {{ i }};
  {%- endfor -%}
{{ "\n" }}
{%- endif -%}

{%- set options = server.default_options|default([]) -%}

{%- if server.dhcpd.options is defined -%}
  {%- do options.extend(server.dhcpd.options) -%}
{%- endif -%}

{%- for o in options %}
option {{ o }};
{%- endfor -%}
{%- set options = [] -%}

{%- endif -%}
